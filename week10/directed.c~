#include"directed.h"


Graph createGraph()
{
  Graph g;
  g.edges = make_jrb();
  g.vertices = make_jrb();
  return g;
}

void addVertex(Graph g, int id, Jval name)
{
  JRB node, node1, tree;
  node = jrb_find_int(g.vertices, id);
  if(node == NULL)
    {
      jrb_insert_int(g.vertices, id, name);
    }
  else {
    printf("The vertex exists!!!\n");
    return;
  }
  node1 = jrb_find_int(g.edges, id);
  if(node1 == NULL)
    {
      tree = make_jrb();
      jrb_insert_int(g.edges, id, new_jval_v(tree));
    }
}

void addEdge(Graph g, int v1, int v2)
{
  JRB node;
  node = jrb_find_int(g.edges, v1);
  if(jrb_find_int((JRB)jval_v(node->val), v2) == NULL)
    {
      jrb_insert_int((JRB)jval_v(node->val), v2, new_jval_i(1));
    }
}

Jval getVertex(Graph g, int id)
{
  JRB node;
  node = jrb_find_int(g.vertices, id);
  return node->val;
}

JRB adjVertex(Graph g, int v)
{
  JRB node;
  node = jrb_find_int(g.edges, v);
  if(node == NULL)
    return NULL;
  return (JRB)jval_v(node->val);
}

int hasEdge(Graph g, int v1, int v2)
{
  JRB adj, tnode, tnode1, adj1;

  adj = adjVertex(g, v1);
  jrb_traverse(tnode, adj)
    {
      if( v2 == jval_i(tnode->key))
	{
	  adj1 = adjVertex(g, v2);
	  jrb_traverse(tnode1, adj1)
	    {
	      if(v1 == jval_i(tnode1->key))
		return 1;
	    }
	  return 0;
	}
      
    }

  adj1 = adjVertex(g, v2);
  jrb_traverse(tnode1, adj1)
    {
      if(v1 == jval_i(tnode1->key))
	{
	  return 1;
	}

    }
  
  return 0;
  
}

int indegree(Graph g, int v, int *output)
{
  JRB node, node1, adj;
  int total =0;
  if(jrb_find_int(g.edges, v) == NULL)
    return 0;
  jrb_traverse(node, g.edges)
    {
      adj = (JRB)jval_v(node->val);
      jrb_traverse(node1, adj)
	{
	  if(jval_i(node1->key) == v)
	    {
	      output[total++] = jval_i(node->key);
	    }
	}
    }
  return total;
}

int outdegree(Graph g, int v, int *output)
{
  JRB node, adj;
  int total =0;
  if(jrb_find_int(g.edges, v) == NULL)
    return total;
  adj = adjVertex(g, v);
  jrb_traverse(node, adj)
    {
      output[total++] = jval_i(node->key);
    }
  return total;
}


int DAG(Graph g)
{
  JRB node, node1;
  Dllist stack;
  int visited[max];
  int output[max];
  stack = new_dllist();
  
  jrb_traverse(node, g.edges)
    {
      stack = new_dllist();
      jrb_traverse()
    }
  return 0;
}


void dropGraph(Graph g)
{
  JRB node;

  jrb_traverse(node, g.edges)
    {
      jrb_free_tree((JRB)jval_v(node->val));
    }
  jrb_free_tree(g.edges);
  jrb_free_tree(g.vertices);
}

int main()
{
  Graph g = createGraph();
  addVertex(g, 0, new_jval_s("V0"));
  addVertex(g, 1, new_jval_s("V1"));
  addVertex(g, 2, new_jval_s("V2"));
  addVertex(g, 3, new_jval_s("V3"));

  addEdge(g, 0, 1);
  addEdge(g, 1, 2);
  addEdge(g, 2, 0);
  addEdge(g, 1, 3);

  printf("%s\n", jval_s(getVertex(g, 1)));
  int arr[max];
  int total = outdegree(g, 1, arr);
  for(int i =0; i < total; i++)
    {
      printf("%d\t", arr[i]);
    }
  printf("\n");
  return 0;
  
}
